# نظام إدارة المقاعد (Seat Management System)

---

## Executive Summary

يُعد نظام إدارة المقاعد من أهم الأنظمة الفرعية في منصة حجز الباصات، حيث يتولى مسؤولية إدارة المخزون الحيوي للمنصة - المقاعد. يضمن هذا النظام دقة وسلامة عمليات حجز المقاعد، ويمنع الحجز المزدوج، ويوفر آلية فعالة للحجز المؤقت قبل إتمام الدفع.

في بيئة تشغيلية معقدة تشمل مكاتب متعددة ورحلات متزامنة، يكتسب هذا النظام أهمية حرجة لضمان تجربة حجز سلسة وخالية من الأخطاء. يتعامل النظام مع تحديات فريدة مثل إدارة تخطيطات المقاعد المختلفة لأنواع الباصات المتنوعة، والحفاظ على تناسق البيانات في ظل عمليات متزامنة عالية.

---

## Business Objectives

### الأهداف الاستراتيجية

| الهدف | الوصف | المؤشر |
|-------|-------|--------|
| منع الحجز المزدوج | ضمان عدم بيع نفس المقعد مرتين | نسبة الحجوزات المزدوجة = 0 |
| تحسين الإشغال | تعظيم استغلال سعة الباصات | متوسط نسبة الإشغال |
| تقليل الاحتكاك | تبسيط عملية اختيار المقعد | وقت اختيار المقعد |
| المرونة | دعم تخطيطات مقاعد مختلفة | عدد التخطيطات المدعومة |

### الأهداف التشغيلية

1. **دقة البيانات**: ضمان دقة حالة المقاعد في الوقت الفعلي
2. **الأداء**: معالجة عمليات الحجز بسرعة عالية
3. **الموثوقية**: ضمان عدم فقدان حجوزات المقاعد
4. **الشفافية**: توفير رؤية واضحة للمقاعد المتاحة

---

## Scope

### داخل النطاق

```
┌─────────────────────────────────────────────────────────────────┐
│                  نطاق نظام إدارة المقاعد                          │
├─────────────────────────────────────────────────────────────────┤
│  ✓ إدارة تخطيطات المقاعد (Seat Layout Management)               │
│  ✓ تعريف المقاعد (Seat Definition)                              │
│  ✓ حجز المقاعد (Seat Booking)                                   │
│  ✓ الحجز المؤقت (Seat Hold/Reservation)                         │
│  ✓ إلغاء حجز المقاعد (Seat Cancellation)                        │
│  ✓ تغيير المقاعد (Seat Change)                                  │
│  ✓ قفل المقاعد (Seat Locking)                                   │
│  ✓ تصنيف المقاعد (Seat Classification)                          │
│  ✓ تسعير المقاعد (Seat Pricing)                                 │
│  ✓ عرض المقاعد (Seat Visualization)                             │
│  ✓ مزامنة حالة المقاعد (Seat State Synchronization)             │
└─────────────────────────────────────────────────────────────────┘
```

### خارج النطاق

- اختيار المقعد الفعلي في الباص
- إدارة الراحة والتوقفات
- خدمات إضافية على المقعد

---

## Detailed Functional Requirements

### FR-SM-001: إدارة تخطيطات المقاعد

| المعرف | المتطلب | الأولوية | التفاصيل |
|--------|---------|----------|----------|
| FR-SM-001-01 | إنشاء تخطيط | حرجة | تحديد أبعاد الباص |
| FR-SM-001-02 | تعريف المقاعد | حرجة | رقم، صف، عمود |
| FR-SM-001-03 | تعريف الممر | حرجة | موقع الممر في الباص |
| FR-SM-001-04 | المقاعد المعطلة | عالية | تحديد مقاعد غير متاحة |
| FR-SM-001-05 | أنواع التخطيط | عالية | 2+2، 2+1، 3+2، إلخ |
| FR-SM-001-06 | نسخ تخطيط | متوسطة | نسخ من تخطيط موجود |

### FR-SM-002: تعريف المقاعد

| المعرف | المتطلب | الأولوية | التفاصيل |
|--------|---------|----------|----------|
| FR-SM-002-01 | رقم المقعد | حرجة | معرف فريد للمقعد |
| FR-SM-002-02 | موقع المقعد | حرجة | الصف والعمود |
| FR-SM-002-03 | نوع المقعد | عالية | عادي، مميز، VIP |
| FR-SM-002-04 | مميزات المقعد | عالية | نافذة، ممر، أمامي |
| FR-SM-002-05 | حالة المقعد | حرجة | متاح، محجوز، محجوز مؤقتاً، معطل |

### FR-SM-003: حجز المقاعد

| المعرف | المتطلب | الأولوية | التفاصيل |
|--------|---------|----------|----------|
| FR-SM-003-01 | عرض المقاعد المتاحة | حرجة | قائمة بالمقاعد الفارغة |
| FR-SM-003-02 | اختيار مقعد | حرجة | تحديد مقعد محدد |
| FR-SM-003-03 | التحقق من التوفر | حرجة | التأكد من عدم الحجز المزدوج |
| FR-SM-003-04 | قفل المقعد | حرجة | منع الحجز من قبل آخرين |
| FR-SM-003-05 | تأكيد الحجز | حرجة | بعد إتمام الدفع |
| FR-SM-003-06 | حجز متعدد | عالية | حجز عدة مقاعد دفعة واحدة |

### FR-SM-004: الحجز المؤقت

| المعرف | المتطلب | الأولوية | التفاصيل |
|--------|---------|----------|----------|
| FR-SM-004-01 | حجز مؤقت | حرجة | حجز مؤقت قبل الدفع |
| FR-SM-004-02 | مدة الحجز المؤقت | حرجة | 15 دقيقة افتراضياً |
| FR-SM-004-03 | تمديد الحجز المؤقت | عالية | تمديد إذا لزم الأمر |
| FR-SM-004-04 | إلغاء الحجز المؤقت | حرجة | عند انتهاء المدة |
| FR-SM-004-05 | إشعار انتهاء المدة | عالية | تنبيه قبل الانتهاء |
| FR-SM-004-06 | حد الحجز المؤقت | عالية | عدد محدد من المقاعد |

### FR-SM-005: إلغاء حجز المقاعد

| المعرف | المتطلب | الأولوية | التفاصيل |
|--------|---------|----------|----------|
| FR-SM-005-01 | إلغاء الحجز | حرجة | إرجاع المقعد للمتاح |
| FR-SM-005-02 | شروط الإلغاء | حرجة | حسب سياسة الإلغاء |
| FR-SM-005-03 | إرجاع المقعد | حرجة | تحديث الحالة فوراً |
| FR-SM-005-04 | سجل الإلغاء | عالية | تسجيل سبب الإلغاء |

### FR-SM-006: تغيير المقاعد

| المعرف | المتطلب | الأولوية | التفاصيل |
|--------|---------|----------|----------|
| FR-SM-006-01 | طلب تغيير المقعد | عالية | قبل موعد الرحلة |
| FR-SM-006-02 | التحقق من التوفر | حرجة | التأكد من وجود مقعد بديل |
| FR-SM-006-03 | تغيير المقعد | عالية | نقل الحجز للمقعد الجديد |
| FR-SM-006-04 | فرق السعر | عالية | حساب الفرق إن وجد |

### FR-SM-007: تصنيف وتسعير المقاعد

| المعرف | المتطلب | الأولوية | التفاصيل |
|--------|---------|----------|----------|
| FR-SM-007-01 | تصنيف المقاعد | عالية | عادي، مميز، VIP |
| FR-SM-007-02 | تسعير حسب التصنيف | عالية | أسعار مختلفة |
| FR-SM-007-03 | تسعير حسب الموقع | عالية | نافذة، ممر، أمامي |
| FR-SM-007-04 | عرض الأسعار | حرجة | عرض السعر لكل مقعد |

### FR-SM-008: عرض المقاعد

| المعرف | المتطلب | الأولوية | التفاصيل |
|--------|---------|----------|----------|
| FR-SM-008-01 | عرض تخطيطي | حرجة | خريطة بصرية للمقاعد |
| FR-SM-008-02 | تمييز الحالات | حرجة | ألوان مختلفة لكل حالة |
| FR-SM-008-03 | تفاعلية | حرجة | النقر لاختيار المقعد |
| FR-SM-008-04 | معلومات المقعد | عالية | عرض تفاصيل عند التمرير |
| FR-SM-008-05 | عرض الممر | حرجة | تمييز واضح للممر |

---

## Non-Functional Requirements

### NFR-SM-001: الأداء

| المعرف | المتطلب | القيمة |
|--------|---------|--------|
| NFR-SM-001-01 | وقت تحميل خريطة المقاعد | < 1 ثانية |
| NFR-SM-001-02 | وقت حجز المقعد | < 500 مللي ثانية |
| NFR-SM-001-03 | عدد العمليات المتزامنة | 1000+ |

### NFR-SM-002: الدقة والاتساق

| المعرف | المتطلب | الأولوية |
|--------|---------|----------|
| NFR-SM-002-01 | منع الحجز المزدوج | حرجة |
| NFR-SM-002-02 | مزامنة فورية للحالة | حرجة |
| NFR-SM-002-03 | عدم فقدان الحجوزات | حرجة |

---

## Use Cases

### UC-SM-001: حجز مقعد

| العنصر | الوصف |
|--------|-------|
| الممثل | العميل |
| الشرط المسبق | اختيار رحلة |
| السيناريو | 1. عرض خريطة المقاعد<br>2. اختيار مقعد متاح<br>3. التحقق من التوفر<br>4. حجز مؤقت<br>5. إتمام الدفع<br>6. تأكيد الحجز |
| الشرط النهائي | مقعد محجوز باسم العميل |

### UC-SM-002: إلغاء حجز مقعد

| العنصر | الوصف |
|--------|-------|
| الممثل | العميل |
| الشرط المسبق | وجود حجز مؤكد |
| السيناريو | 1. طلب إلغاء<br>2. التحقق من شروط الإلغاء<br>3. تأكيد الإلغاء<br>4. إرجاع المقعد |
| الشرط النهائي | المقعد متاح مرة أخرى |

---

## Actors

| الممثل | الوصف |
|--------|-------|
| العميل | حجز وإدارة المقاعد |
| ممثل المكتب | عرض وإدارة مقاعد الرحلات |
| النظام | إدارة الحجز المؤقت والمزامنة |

---

## Workflows

### سير عمل حجز المقعد

**المرحلة الأولى: العرض**
- استلام طلب عرض المقاعد
- جلب تخطيط الباص
- جلب حالة المقاعد
- تنسيق البيانات للعرض

**المرحلة الثانية: الاختيار**
- استلام اختيار المقعد
- التحقق من التوفر
- قفل المقعد مؤقتاً

**المرحلة الثالثة: التأكيد**
- استلام تأكيد الدفع
- تحويل الحجز المؤقت لمؤكد
- تحديث الحالة نهائياً

### سير عمل الحجز المؤقت

**إنشاء الحجز المؤقت**
- التحقق من التوفر
- قفل المقعد
- بدء المؤقت

**المراقبة**
- متابعة الوقت المتبقي
- إرسال تنبيه قبل الانتهاء

**الانتهاء**
- إلغاء القفل
- إرجاع المقعد
- أو تحويل لمؤكد عند الدفع

---

## Data Entities (Conceptual)

| الكيان | الوصف |
|--------|-------|
| SeatLayout | تخطيط مقاعد الباص |
| Seat | تعريف المقعد |
| SeatStatus | حالة المقعد |
| SeatHold | الحجز المؤقت |
| SeatBooking | الحجز المؤكد |
| SeatType | نوع المقعد |
| SeatPrice | سعر المقعد |

---

## Business Rules

| المعرف | القاعدة |
|--------|--------|
| BR-SM-001 | لا يمكن حجز مقعد محجوز |
| BR-SM-002 | الحجز المؤقت ينتهي تلقائياً بعد 15 دقيقة |
| BR-SM-003 | يجب تأكيد الحجز بالدفع |
| BR-SM-004 | لا يمكن إلغاء الحجز بعد انطلاق الرحلة |
| BR-SM-005 | يجب مزامنة حالة المقاعد فوراً |
| BR-SM-006 | المقاعد المعطلة لا تظهر للحجز |

---

## Edge Cases

| الحالة | الوصف | المعالجة |
|--------|-------|----------|
| EC-SM-001 | حجز مزدوج | رفض الحجز الثاني |
| EC-SM-002 | فشل الدفع بعد الحجز المؤقت | إلغاء الحجز المؤقت |
| EC-SM-003 | انتهاء الجلسة أثناء الحجز | حفظ الحالة |
| EC-SM-004 | طلب نفس المقعد من جهازين | الأول يحجز، الثاني يرفض |
| EC-SM-005 | تغيير تخطيط الباص بعد حجوزات | إشعار العملاء |

---

## Risk Considerations

| المخطر | الاحتمالية | التأثير | الاستراتيجية |
|--------|-----------|---------|--------------|
| الحجز المزدوج | منخفض | حرج | قفل متفائل |
| فقدان حجز | منخفض | حرج | نسخ احتياطي |
| تأخر المزامنة | منخفض | عالي | تحديث فوري |

---

## Future Enhancements

| التحسين | الوصف | الأولوية |
|---------|-------|----------|
| FE-SM-001 | اختيار مقعد ذكي | عالية |
| FE-SM-002 | حجز مقاعد مجاورة تلقائياً | متوسطة |
| FE-SM-003 | تفضيلات المقعد للعميل | متوسطة |
| FE-SM-004 | عرض ثلاثي الأبعاد | منخفضة |

---

*تم إعداد هذا الملف بواسطة فريق تحليل الأنظمة - منصة حجز الباصات*
*الإصدار: 1.0*
